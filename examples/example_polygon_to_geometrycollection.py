from shapely.geometry.collection import GeometryCollection
from shapely.ops import snap

from brdr.enums import SnapStrategy
from brdr.geometry_utils import geom_from_wkt, snap_geometry_to_reference, safe_unary_union

point_1 = geom_from_wkt("POINT (174043.75093678693519905 179298.98393741055042483)" )
point_2 = geom_from_wkt("POINT (174079.35689694649772719 179283.04217797549790703)" )
line_1 = geom_from_wkt("LINESTRING (174021.41628905048128217 179291.53905483175185509, 174081.29904022792470641 179294.45226975387777202)")
line_2 = geom_from_wkt(
    "LINESTRING (174039.13834649353520945 179282.79941006531589665, 174038.16727485283627175 179272.92684838469722308, 174052.65242682682583109 179273.33146156833390705, 174093.43743573685060255 179285.46985707725980319)" )
polygon_1 = geom_from_wkt("POLYGON ((174029.67039799655321985 179306.67158789956010878, 174048.44444971703342162 179306.18605207919608802, 174048.92998553739744239 179258.92723223107168451, 174030.15593381691724062 179259.41276805143570527, 174029.67039799655321985 179306.67158789956010878))" )
polygon_2 = geom_from_wkt("POLYGON ((174054.91826065513305366 179305.53867098540649749, 174056.37486811622511595 179258.76538695761701092, 174072.72124073491431773 179260.38383969213464297, 174070.61725218003266491 179306.99527844646945596, 174054.91826065513305366 179305.53867098540649749))")
geometries =[
    point_1,point_2,
    line_1,line_2,
    polygon_1,polygon_2]

geom_reference = safe_unary_union(geometries)
#geom_reference = GeometryCollection(geometries)
print (geom_reference.wkt)
thematic_geom = geom_from_wkt(
    "POLYGON ((174043.1035556931165047 179299.26716663906699978, 174042.53709723605425097 179306.22651339753065258, 174048.52537235378986225 179305.9837454873486422, 174055.16102856534416787 179305.49820966698462144, 174055.16102856534416787 179293.19796888460405171, 174071.26463327385135926 179293.92627261512097903, 174071.34555591057869606 179287.69522958720335737, 174083.40302878280635923 179282.83987138362135738, 174072.154782277852064 179278.14635845352313481, 174072.72124073494342156 179260.58614628392388113, 174056.69855866313446313 179258.88677091267891228, 174048.60629499051719904 179273.21007761321379803, 174038.97650122008053586 179273.85745870703249238, 174041.97063877896289341 179286.72415794650441967, 174044.96477633781614713 179292.71243306424003094, 174035.25405993068125099 179292.14597460714867339, 174043.1035556931165047 179299.26716663906699978))")
geom_snapped = snap_geometry_to_reference(
    thematic_geom,
    geom_reference,
    snap_strategy=SnapStrategy.PREFER_VERTICES,
    max_segment_length=2,
    tolerance=5
)
geom_snapped_shapely = snap(
    thematic_geom,
    geom_reference,
    tolerance=5
)
print(geom_snapped.wkt)
