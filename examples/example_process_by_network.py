from datetime import datetime

from brdr.grb import GRBActualLoader

# 2 volledige percelen
wkt = "POLYGON ((171458.40769685542909428 173434.00596392978332005, 171474.2560220179730095 173411.11393869499443099, 171508.59405987019999884 173435.47340144484769553, 171496.26758474376401864 173457.48496417060960084, 171458.40769685542909428 173434.00596392978332005))"

# 2 percelen, die maar voor deel zijn opgenomen
wkt = "POLYGON ((171430.14118172021699138 173479.82555389904882759, 171444.37532561598345637 173455.46609114957391284, 171474.311050922551658 173475.42324135397211649, 171466.68037584441481158 173486.72251021966803819, 171456.2615694877167698 173480.99950391106540337, 171450.53856317911413498 173490.83133526175515726, 171430.14118172021699138 173479.82555389904882759))"

# LINESTRING
wkt = "LINESTRING (171761.43755743509973399 171790.2652638778090477, 171748.80683215140015818 171775.05934217703179456, 171759.59813142291386612 171766.1074689177039545, 171736.05347846687072888 171738.39345033402787521, 171722.80961117908009328 171721.71598782346700318, 171702.20803984254598618 171713.86777017143322155, 171657.08078834347543307 171750.16577681200578809)"
wkt = "LINESTRING (171761.43755743509973399 171790.2652638778090477, 171748.80683215140015818 171775.05934217703179456, 171759.59813142291386612 171766.1074689177039545, 171736.05347846687072888 171738.39345033402787521, 171722.80961117908009328 171721.71598782346700318, 171702.20803984254598618 171713.86777017143322155, 171657.08078834347543307 171750.16577681200578809)"
# wkt = "LINESTRING (171683.4562208010465838 171729.5498014944314491, 171656.79526541969971731 171750.05421532000764273)"
# polygon
# wkt = "POLYGON ((172373.49450000008800998 171916.36339999991469085, 172375.07079888536827639 171915.86060035554692149, 172381.56139999991864897 171913.79009999992558733, 172386.0773999999219086 171912.34940000000642613, 172382.07879999963915907 171901.1977999992959667, 172380.93520000000717118 171899.06330000000889413, 172353.03710000042337924 171909.17959999991580844, 172346.14040000009117648 171915.37019999991753139, 172323.24830000018118881 171898.63199999992502853, 172303.08080000008339994 171908.80360000001383014, 172319.65799999999580905 171920.94149999998626299, 172331.64050000018323772 171929.71510000000125729, 172358.60449999998672865 171921.11350000009406358, 172373.49450000008800998 171916.36339999991469085))"
# wkt = "MULTIPOLYGON (((171795.71618631482124329 171817.88460136577486992, 171784.53532230854034424 171806.1688893586397171, 171746.73993028700351715 171841.20300138369202614, 171746.28380228579044342 171841.62578538432717323, 171767.35881029814481735 171856.89906539395451546, 171767.47471430152654648 171856.76376939192414284, 171798.38581831753253937 171820.68191336840391159, 171798.01820231974124908 171820.29669736698269844, 171795.71618631482124329 171817.88460136577486992)))"
# polygon with inner hole
# wkt = "MULTIPOLYGON (((172315.66613867878913879 171793.47583334892988205, 172308.03785067051649094 171786.95864934474229813, 172301.2083466649055481 171781.12389734014868736, 172300.98095466941595078 171781.42610534280538559, 172284.30806343944277614 171804.47251285600941628, 172298.57067592954263091 171815.30351933347992599, 172315.66613867878913879 171793.47583334892988205),(172296.22812266647815704 171792.04754534736275673, 172296.93429866433143616 171792.65087334811687469, 172297.15573866665363312 171792.83999335020780563, 172301.40373867005109787 171787.86751334741711617, 172309.99535467475652695 171795.20754535123705864, 172301.64860266447067261 171804.97759335860610008, 172298.15113066881895065 171801.98962535709142685, 172299.64514666795730591 171800.24088935554027557, 172294.55100266635417938 171795.88888934999704361, 172295.03810666501522064 171795.31864935159683228, 172294.11061866581439972 171794.52613735198974609, 172296.15733866393566132 171792.1304253488779068, 172296.22812266647815704 171792.04754534736275673)))"
wkt = "LINESTRING (172046.34003555416711606 172020.84017656184732914, 172046.80410725172259845 172017.77730335804517381, 172049.58853743696818128 172014.06472977771773003, 172054.32206875190604478 172007.3820973331166897, 172065.45978949291747995 171995.13060451796627603, 172070.47176382638281211 171988.81922943139215931)"
wkt = "MULTILINESTRING ((173934.33078331346041523 178823.6009470286371652, 173712.94672791371704079 178757.57412348836078309, 173758.99905021491576917 178639.94650508047197945, 173775.64446791415684856 178599.99750260231667198, 173775.08962065743980929 178510.66709428312606178, 173830.57434632154763676 178211.04957569699035957, 173999.24791234041913413 178224.36590985636576079, 174079.14591729670064524 178339.77413923770654947, 174230.06437110307160765 178375.28436366270761937, 174185.67659057179116644 178444.08542348619084805, 174088.02347340298001654 178415.23336614086292684, 174070.26836119045037776 178477.37625888467300683, 174150.16636614676099271 178563.93243092065677047, 174152.38575517333811149 178630.5141017175919842, 174068.04897216390236281 178721.50905180670088157, 173977.05402207476436161 178663.80493711604503915, 173961.51829888881184161 178690.43760543479584157, 173943.76318667631130666 178788.09072260360699147))"
from brdr.aligner import Aligner
from brdr.enums import OpenDomainStrategy, GRBType
from brdr.geometry_utils import geom_from_wkt
from brdr.loader import DictLoader

print(datetime.now())
# CREATE AN ALIGNER
aligner = Aligner(
    crs="EPSG:31370",
)
# ADD A THEMATIC POLYGON TO THEMATIC DICTIONARY and LOAD into Aligner
thematic_dict = {"theme_id_1": geom_from_wkt(wkt)}
loader = DictLoader(thematic_dict)
aligner.load_thematic_data(loader)
# ADD A REFERENCE POLYGON TO REFERENCE DICTIONARY and LOAD into Aligner
# loader = GRBActualLoader(grb_type=GRBType.ADP, partition=1000, aligner=aligner)
loader = GRBActualLoader(grb_type=GRBType.ADP, partition=1000, aligner=aligner)
aligner.load_reference_data(loader)
# EXECUTE THE ALIGNMENT
relevant_distance = 4
process_result = aligner.process(
    relevant_distance=relevant_distance,
    od_strategy=OpenDomainStrategy.SNAP_ALL_SIDE,
    threshold_overlap_percentage=50,
)

# PRINT RESULTS IN WKT
print("result: " + process_result["theme_id_1"][relevant_distance]["result"].wkt)
print(
    "added area: "
    + process_result["theme_id_1"][relevant_distance]["result_diff_plus"].wkt
)
print(
    "removed area: "
    + process_result["theme_id_1"][relevant_distance]["result_diff_min"].wkt
)
print(datetime.now())
# aligner.predictor()
print(datetime.now())
