from brdr.grb import GRBActualLoader

#2 volledige percelen
wkt ="POLYGON ((171458.40769685542909428 173434.00596392978332005, 171474.2560220179730095 173411.11393869499443099, 171508.59405987019999884 173435.47340144484769553, 171496.26758474376401864 173457.48496417060960084, 171458.40769685542909428 173434.00596392978332005))"

#2 percelen, die maar voor deel zijn opgenomen
wkt="POLYGON ((171430.14118172021699138 173479.82555389904882759, 171444.37532561598345637 173455.46609114957391284, 171474.311050922551658 173475.42324135397211649, 171466.68037584441481158 173486.72251021966803819, 171456.2615694877167698 173480.99950391106540337, 171450.53856317911413498 173490.83133526175515726, 171430.14118172021699138 173479.82555389904882759))"

#LINESTRING
wkt="LINESTRING (171761.43755743509973399 171790.2652638778090477, 171748.80683215140015818 171775.05934217703179456, 171759.59813142291386612 171766.1074689177039545, 171736.05347846687072888 171738.39345033402787521, 171722.80961117908009328 171721.71598782346700318, 171702.20803984254598618 171713.86777017143322155, 171657.08078834347543307 171750.16577681200578809)"

#polygon
wkt="POLYGON ((172373.49450000008800998 171916.36339999991469085, 172375.07079888536827639 171915.86060035554692149, 172381.56139999991864897 171913.79009999992558733, 172386.0773999999219086 171912.34940000000642613, 172382.07879999963915907 171901.1977999992959667, 172380.93520000000717118 171899.06330000000889413, 172353.03710000042337924 171909.17959999991580844, 172346.14040000009117648 171915.37019999991753139, 172323.24830000018118881 171898.63199999992502853, 172303.08080000008339994 171908.80360000001383014, 172319.65799999999580905 171920.94149999998626299, 172331.64050000018323772 171929.71510000000125729, 172358.60449999998672865 171921.11350000009406358, 172373.49450000008800998 171916.36339999991469085))"

from brdr.aligner import Aligner
from brdr.enums import OpenDomainStrategy, GRBType
from brdr.geometry_utils import geom_from_wkt
from brdr.loader import DictLoader

# CREATE AN ALIGNER
aligner = Aligner(
    crs="EPSG:31370",
)
# ADD A THEMATIC POLYGON TO THEMATIC DICTIONARY and LOAD into Aligner
thematic_dict = {"theme_id_1": geom_from_wkt(wkt)}
loader = DictLoader(thematic_dict)
aligner.load_thematic_data(loader)
# ADD A REFERENCE POLYGON TO REFERENCE DICTIONARY and LOAD into Aligner
loader = GRBActualLoader(grb_type=GRBType.ADP, partition=1000, aligner=aligner)
aligner.load_reference_data(loader)
# EXECUTE THE ALIGNMENT
relevant_distance = 4
process_result = aligner.process(
    relevant_distance=relevant_distance,
    od_strategy=OpenDomainStrategy.SNAP_ALL_SIDE,
    threshold_overlap_percentage=50,
)
# PRINT RESULTS IN WKT
print("result: " + process_result["theme_id_1"][relevant_distance]["result"].wkt)
print(
    "added area: "
    + process_result["theme_id_1"][relevant_distance]["result_diff_plus"].wkt
)
print(
    "removed area: "
    + process_result["theme_id_1"][relevant_distance]["result_diff_min"].wkt
)
